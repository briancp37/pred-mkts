# [0-5] Telemetry & runbook
[Back to task list](../tasks.md)

## Description
Add structured telemetry and developer documentation for the rate limiter and DataSource substrate.  
Telemetry should help operators understand API utilization, throttling events, and retry behavior.  
Runbook explains configuration, log interpretation, and debugging of rate-limit issues.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-15 09:05:00 | Created | N/A | Proposed | Task file created | you |
| 2025-10-15 21:17:00 | Completed | Proposed | Completed | Telemetry module, rate limiter integration, runbook, and tests completed | AI Assistant |

## Requirements
- Structured logging (JSON or key=value) with fields:
  - `timestamp`, `exchange`, `endpoint`, `status`, `elapsed_ms`, `decision`, `sleep_s`, `headers_seen`.
- Configurable verbosity (info/debug).
- Optional in-memory stats summary for tests (e.g., total sleeps, avg latency).
- Markdown runbook (`docs/technical/rate-limit-runbook.md`) describing:
  - meaning of each field,
  - common header patterns for major exchanges,
  - how to tune config values,
  - example telemetry snippets.
- Grep anchors: `# [CTX:PBI-0:0-5:TELEM]`.

## Implementation Plan
- Integrate telemetry hooks into limiter and DataSource calls.
- Write runbook with examples for Polymarket and Kalshi.
- Add pytest verifying log output fields.

## Verification (Test Plan)
- Logs contain expected keys for success and throttle paths.
- Runbook passes Markdown link checker.
- Developer can read telemetry and reproduce backoff reasoning.

## Files Modified
- `src/pred_mkts/core/telemetry.py` - New module for structured telemetry
- `src/pred_mkts/core/rate_limiter.py` - Integrated telemetry hooks
- `docs/technical/rate-limit-runbook.md` - Comprehensive runbook documentation
- `tests/unit/test_telemetry.py` - Full test coverage (26 tests, all passing)
