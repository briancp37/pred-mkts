# [0-6] E2E CoS test for PBI-0
[Back to task list](../tasks.md)

## Description
End-to-end test verifying the substrate and limiter together meet all Conditions of Satisfaction for PBI-0.  
Demonstrates stable throughput, adaptive throttling, and recovery from simulated 429/5xx scenarios.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-15 09:10:00 | Created | N/A | Proposed | Task file created | you |

## Requirements
- Launch stub server (Task 0-4).
- Use real limiter (Task 0-3) and config (Task 0-2).
- Perform a scripted sequence of requests that:
  1. Stay below limit (no sleeps).
  2. Exceed limit → receive 429 + Retry-After → limiter pauses then resumes.
  3. Simulate adaptive headers (limit/reset) → limiter adjusts.
  4. Introduce intermittent 5xx → retries w/ backoff.
- Capture telemetry (Task 0-5) for verification.

## Implementation Plan
- Use pytest integration test under `tests/e2e/test_pbi0_e2e.py`.
- Assertions:
  - Total runtime ≈ expected from rate config.
  - No unhandled exceptions.
  - Telemetry shows correct decision sequence.
- Tag in code: `# [CTX:PBI-0:0-6:E2E]`.

## Verification (Test Plan)
- Test passes deterministically under CI.
- Logs confirm Retry-After honored and throughput restored.
- Produces artifact `artifacts/test_logs/pbi0_e2e.log` for manual inspection.

## Files Modified
- `tests/e2e/test_pbi0_e2e.py`
- `artifacts/test_logs/pbi0_e2e.log`
